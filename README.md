deliver: a Go package manager
=======

Deliver is a command-line tool to fetch and update package dependencies in a Go project.
It can also be used to automatically manage different Go workspaces for different projects.

A Git repository defines its package dependencies in a file called `packages.json`.

```
{
    "repository": "github.com/edmodo/auth",
    "packages": {
        "github.com/edmodo/minion": {
            "source": "git@github.com:edmodo/minion.git",
        },
        "git.apache.org/thrift.git": {
            "source": "git@github.com:edmodo/thrift.git",
            "branch": "edmodo-0.9.1"
        }
    }
}
```

Each dependency specifies a source, which is the URL of the remote repository hosting the package. Note that the source can be different from the package name (useful when we need to fork a repository). You can also specify a branch to use from the remote repository.

In addition to `packages.json`, the repository defines the current versions of the packages it's using in a lockfile called `packages.lock`. This file is generated by deliver and should not be modified by hand. This file is used to ensure the same build can be reproduced in any environment.

### Installation

1. Install deliver on your machine. Download it from here (or compile it from source) and place it in a directory on your PATH.
2. Add `alias go='GOPATH=$(deliver path) go'` to ~/.bashrc. Run `source ~/.bashrc`.

### Usage
- `deliver update` updates each package in `packages.json` to the tip the latest version. The version information is saved to the lockfile. 
- `deliver update [package name]` is the same as `deliver update`, but runs only for a single package.
- `deliver install` updates each package in the lockfile to the specified revision.
- `deliver install [package name]` is the same as `deliver install`, but runs only for a single package.

#### Implementation
Deliver maintains a separate Go workspace per project (in a directory called `workspace/`). By aliasing the `go` command, deliver switches the GOPATH environment variable so that builds and installs happen in each project's workspace.

Running `deliver install -deliver_workspace=true` does the following steps:
- create a `workspace/` directory in the repository (ignored by git).
- download the locked versions of all packages listed in `packages.lock` into `workspace/src`.
- recursively download any dependencies of the packages into `workspace/src`.
- create a symlink for `auth` if "repository" is present in `packages.json`.
```
> deliver install
installing github.com/edmodo/minion
getting dependencies of github.com/edmodo/minion
installing github.com/coopernuse/gorp
done with dependencies of github.com/edmodo/minion
installing git.apache.org/thrift.git
done.
> ls
models/
main/
users_handler.go
packages.json
packages.lock
workspace/
    bin/
    pkg/
    src/
        github.com/
            edmodo/
                auth/ -> ~/auth
                minion/
                thrift-services/
            coopernurse/
                gorp/
        git.apache.org/
            thrift.git/
```

#### Remaining work
- Detect cyclical package dependencies.
- Detect conflicts between locked revisions of dependencies.
- Detect if current workspace is out-of-date compared to the lockfile.
